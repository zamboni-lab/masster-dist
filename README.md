# MASSter

**MASSter** is a Python package for the analysis of metabolomics experiments by LC-MS/MS data, with a main focus on the challenging tasks of untargeted and large-scale studies. This repository provides releases, documentation, and issue tracking.

## Background and motivation

MASSter is actively used, maintained, and developed by the Zamboni Lab at ETH Zurich. The project started in 2025 because many needs were unmet by common software packages (mzMine, MS-DIAL, W4, etc.), such as performance, scalability, sensitivity, robustness, speed, rapid implementation of new features, and integration into ETL systems.

As of January 2026, the codebase includes over 60,000 lines of code and offers a wide range of possibilities. MASSter has become the workhorse for all of our work, from R&D to routine analyses, from small to large-scale studies, from DDA to DIA, across all vendors.

We decided to make MASSter public primarily for these reasons:
* **FAIRification of data processing**: We want others to be able to reproduce our results starting from raw data, using fully parameterized scripts that do not depend on human interaction.
* **Empowering other labs**: To allow other labs to immediately benefit from the latest developments we implement.

## Content

MASSter is designed to handle LC-MS/MS data, regardless of whether it is DDA, DIA/SWATH, or DIA/ZTScan. We still rely on the potent and fast feature detection provided by OpenMS, but we have redesigned everything else: centroiding, RT alignment, adduct and isotopomer detection, merging of multiple samples, gap-filling, quantification, extraction of the best MS2 spectra across the entire study, visualization, and export to mzTab-M, MGF, parquet, etc.

MASSter does **not** include:
* downstream data analysis: Simple approaches like PCA, UMAP, or ANOVA are integrated for QC, but we didn't include methods for normalization or pathway analysis, etc.
* annotation by MS2 with spectral matching: by design, we outsource MS2 annotation to external tools, like LipidOracle or timaR. Masster has import functions to read the results of annotation and embed them into visualization and export files.
* support for ion mobility, or MS3 data.
* a GUI: we stick to Python scripts. Interactive data exploration is possible by notebooks (Jupyter or Marimo)

## Architecture

MASSter defines classes for Spectra, Chromatograms, Libraries, Samples, and Studies (a Study is a collection of samples, such as an LC–MS sequence). Users will typically work with a single `Study` object at a time. `Sample` objects are created when analyzing a batch (and saved for caching), or used for development, troubleshooting, or generating illustrations.

The analysis can be done in scripts (without user intervention, e.g., by the integrated Wizard), or interactively in notebooks like [marimo](https://marimo.io/) or [jupyter](https://jupyter.org/).

MASSter was engineered to maximize quality, sensitivity, scalability, and speed. While Python can be slower than other languages, considerable effort was spent on optimization, including the systematic use of Polars, NumPy vectorization, multiprocessing, and chunking. To maximize speed and maintain a small memory footprint, MASSter reads raw data directly, only accessing the fractions relevant for analysis. For example, the analysis of DIA/ZTScan data is effectively as fast as DDA data, even though the files are 10–50x larger. MASSter uses optimized HDF5 files to store results and facilitate portability across operating systems and Python versions. MASSter has been tested on studies with over 3,000 LC–MS/MS samples (≈1 million MS2 spectra) and autonomously completed analyses within a few hours.

A design principle of MASSter is to provide excellent results without requiring extensive optimization or technical knowledge. **In most cases, running the code or the Wizard with default settings is sufficient.**

## Prerequisites

You will need to install Python (3.11-3.13).
**Reading vendor formats relies on .NET libraries and is only possible on Windows**. On Linux or macOS, you will need to use mzML or mz5 data. The latter is recommended over mzML, in particular for large files (DIA).

MASSter uses its own HDF5 file format to save results (i.e., `.sample5` and `.study5`), which is portable across platforms and Python versions. Consequently, any results generated by MASSter are accessible on all operating systems.

**It is recommended to use data in either the vendor's raw formats (WIFF and Thermo RAW) or mzML/mz5 in profile mode (both accessible via Pwiz).** MASSter includes a sophisticated and sufficiently fast centroiding algorithm that works well across the full dynamic range and only acts on relevant spectra. In our tests with data from different vendors, this centroiding performed significantly better than most vendor implementations (which are primarily proteomics-centric).

__Direct access to Bruker *.d, Agilent *.d, and SCIEX *.wiff2 formats is not supported in the public version__. For these vendors, you'll have to convert to mzML/mz5.

## Installation

This repository publishes a PEP 503-compatible package index (for `uv`, `pip`, etc.):

- Index URL: `https://zamboni-lab.github.io/masster-dist/simple/`

`uv` (recommended):
```bash
uv pip install --index https://zamboni-lab.github.io/masster-dist/simple masster
```

`pip`:
```bash
pip install --extra-index-url https://zamboni-lab.github.io/masster-dist/simple masster
```

Project dependency with `uv`:
```bash
uv add --index https://zamboni-lab.github.io/masster-dist/simple masster
```

## Getting started
**The quickest way to use or learn MASSter is to use the integrated Wizard**, which handles most tasks automatically.

The Wizard only needs to know the location of the MS files and where to store the results.
```python
from masster import Wizard
wiz = Wizard(
    source=r'..\..\folder_with_raw_data',    # where to find the data
    folder=r'..\..\folder_to_store_results',  # where to save the results
    ncores=6                                 # optional; don't exceed 8 as the process is limited by disk I/O
    )
wiz.test_and_run()
```

This will trigger the analysis of the raw data and create a script to process all samples and assemble the study. The complete processing workflow will be saved as `1_processing.py` in the output folder. The Wizard will run a initial test and, if successful, execute the full workflow using parallel processes. Once processing is complete, navigate to the output folder to see the results.

If you want to interact with your data, we recommend using [marimo](https://marimo.io/) or [jupyter](https://jupyter.org/) to open the `*.study5` file. For example:

```bash
# Use marimo to open the script created by the Wizard
marimo edit '..\\..\\folder_to_store_results\\2_notebook.py'
# or, if you use uv to manage an environment with masster
uv run marimo edit '..\\..\\folder_to_store_results\\2_notebook.py'
```

## Documentation (Wiki)

More extensive documentation lives in the GitHub wiki:
- [Wiki home](../../wiki)
- [Basic workflows](../../wiki/Basic-Workflows)
- [Analysis of a single sample](../../wiki/Analysis-of-a-single-sample)

### Basic Workflow for analyzing LC-MS study with 1-1000+ samples
See: [Basic workflows](../../wiki/Basic-Workflows).

### Analysis of a single sample
See: [Analysis of a single sample](../../wiki/Analysis-of-a-single-sample).

## Disclaimer

**MASSter is research software under active development.** While we use it extensively in our lab and strive for quality and reliability, please be aware:
- **No warranties**: The software is provided "as is" without any warranty of any kind, express or implied.
- **Backward compatibility**: We do not guarantee backward compatibility between versions. Breaking changes may occur as we improve the software.
- **Performance**: While optimized for our workflows, performance may vary depending on your data and system configuration.
- **Support**: This is an academic project with limited resources. At the moment, we do not provide external user support. Issues can be opened, but there is no guarantee that they will be addressed.
- **Production use**: If you plan to use MASSter in production or critical workflows, thorough testing with your data is recommended.
- **Source code access**: The source code in the public distribution is currently obfuscated. We remain committed to providing full access to the software's functionality and ensuring reproducibility of scientific results. We may explore alternative distribution models in the future that better balance openness with sustainability of the project. Access to source code may be granted for collaboration.

## License
GNU Affero General Public License v3

See the [LICENSE](LICENSE) file for details.

### Third-Party Licenses
This project uses several third-party libraries, including pyOpenMS which is licensed under the BSD 3-Clause License. For complete information about third-party dependencies and their licenses, see [THIRD_PARTY_NOTICES.md](THIRD_PARTY_NOTICES.md).

## Citation
If you use MASSter in your research, please cite this repository.
